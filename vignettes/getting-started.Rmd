---
title: "Getting Started with AMPH Forecast Suite"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started with AMPH Forecast Suite}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction

The AMPH Forecast Suite provides a comprehensive toolkit for building infectious disease forecasting pipelines and hubs. This vignette demonstrates the basic workflow for using the package.

## Installation

First, install the required forecasting packages:

```{r eval=FALSE}
library(AMPHForecastSuite)

# Install all forecasting packages
install_forecast_packages()
```

You can also selectively install specific categories:

```{r eval=FALSE}
# Install only hubverse and forecasting packages
install_forecast_packages(
  install_hubverse = TRUE,
  install_forecasting = TRUE,
  install_epi = FALSE,
  install_data = FALSE
)
```

## Working with Hub Data

### Converting to Fable Format

The package makes it easy to convert hub-formatted data to work with the fable forecasting package:

```{r eval=FALSE}
library(AMPHForecastSuite)

# Create sample hub data
hub_data <- data.frame(
  date = seq.Date(as.Date("2023-01-01"), by = "week", length.out = 20),
  location = "US",
  value = rnorm(20, 100, 10)
)

# Convert to tsibble format for fable
ts_data <- convert_hub_to_tsibble(hub_data)
print(ts_data)
```

### Using Fable for Forecasting

Once your data is in tsibble format, you can use fable for forecasting:

```{r eval=FALSE}
library(fable)
library(tsibble)

# Fit a model
model <- ts_data %>% 
  model(
    arima = ARIMA(value),
    ets = ETS(value)
  )

# Generate forecasts
forecasts <- model %>% forecast(h = 4)

# Convert back to hub format
hub_forecasts <- convert_fable_to_hub(forecasts, location = "US", target = "inc")
```

## Working with EpiEstim

EpiEstim is used to estimate time-varying reproduction numbers:

```{r eval=FALSE}
library(EpiEstim)

# Prepare daily case data
hub_data_daily <- data.frame(
  date = seq.Date(as.Date("2023-01-01"), by = "day", length.out = 50),
  location = "US",
  value = rpois(50, 100)
)

# Convert to EpiEstim format
epiestim_data <- convert_hub_to_epiestim(hub_data_daily, location_filter = "US")

# Estimate R
res <- estimate_R(
  epiestim_data, 
  method = "parametric_si",
  config = make_config(list(mean_si = 7, std_si = 4.5))
)

# Convert results back to hub format
hub_r_estimates <- convert_epiestim_to_hub(res, location = "US")
print(hub_r_estimates)
```

## Working with EpiNow2

EpiNow2 provides more sophisticated estimation and forecasting with delay distributions:

```{r eval=FALSE}
library(EpiNow2)

# Prepare data for EpiNow2
epinow2_data <- convert_hub_to_epinow2(hub_data_daily, location_filter = "US")

# Run EpiNow2 (simplified example)
# Note: You would need to specify generation time and delay distributions
res <- epinow(
  reported_cases = epinow2_data,
  generation_time = generation_time_opts(
    Generation_Time_Opts(mean = 5, sd = 2)
  ),
  delays = delay_opts(
    Delay_Opts(mean = 3, sd = 1)
  )
)

# Convert results back to hub format
hub_forecasts <- convert_epinow2_to_hub(res, location = "US")
print(hub_forecasts)
```

## Building a Complete Pipeline

Here's an example of a complete forecasting pipeline:

```{r eval=FALSE}
# 1. Load data in hub format
hub_data <- load_hub_data()  # Your data loading function

# 2. Generate forecasts with multiple methods
# Method 1: Fable
ts_data <- convert_hub_to_tsibble(hub_data)
fable_model <- ts_data %>% model(ARIMA(value))
fable_fc <- fable_model %>% forecast(h = 4)
fable_hub_fc <- convert_fable_to_hub(fable_fc, location = "US")

# Method 2: EpiEstim for R estimates
epiestim_data <- convert_hub_to_epiestim(hub_data, location_filter = "US")
r_estimates <- estimate_R(epiestim_data, method = "parametric_si",
                          config = make_config(list(mean_si = 7, std_si = 4.5)))
r_hub <- convert_epiestim_to_hub(r_estimates, location = "US")

# 3. Combine forecasts
all_forecasts <- rbind(fable_hub_fc, r_hub)

# 4. Submit to hub
# submit_to_hub(all_forecasts)  # Your submission function
```

## Summary

The AMPH Forecast Suite simplifies the process of:

1. Installing multiple forecasting packages
2. Converting data between different package formats
3. Building comprehensive forecasting pipelines
4. Generating hub-compatible outputs

For more information, see the package documentation and function help pages.
